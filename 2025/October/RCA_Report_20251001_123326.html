<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RCA Report - Specific tickets</title>
    <style>
        body { font-family: -apple-system, Arial, sans-serif; margin: 0; background: #f8f9fa; }
        
        .header { 
            background: linear-gradient(135deg, #7c3aed 0%, #14b8a6 100%); 
            color: white; 
            padding: 25px 40px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 30px;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 25px;
        }
        
        .logo-text {
            font-size: 2rem;
            font-weight: bold;
            display: flex;
            align-items: baseline;
        }
        
        .logo-dot { color: #14b8a6; font-size: 2.5rem; margin: 0 2px; }
        .logo-cloud { color: #14b8a6; }
        
        .divider {
            width: 2px;
            height: 40px;
            background: rgba(255,255,255,0.3);
        }
        
        .report-title {
            font-size: 1.5rem;
            font-weight: 300;
        }
        
        .header-right { display: flex; align-items: center; gap: 40px; }
        .date-info { font-size: 0.95rem; opacity: 0.9; }
        .stats { display: flex; gap: 30px; }
        .stat { text-align: center; }
        .stat-number { font-size: 1.8rem; font-weight: bold; color: #14b8a6; }
        .stat-label { font-size: 0.75rem; opacity: 0.85; text-transform: uppercase; letter-spacing: 0.5px; margin-top: 2px; }
        
        .ai-badge {
            background: #10b981;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
            margin-left: 10px;
        }
        
        .search-section {
            background: white;
            padding: 25px;
            margin: 30px auto;
            max-width: 1400px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .search-container { display: flex; gap: 15px; align-items: center; }
        .search-input { 
            flex: 1; 
            padding: 12px 20px; 
            border: 2px solid #e2e8f0; 
            border-radius: 8px; 
            font-size: 1rem; 
            outline: none; 
        }
        .search-input:focus { 
            border-color: #7c3aed; 
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1); 
        }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 0 20px 40px; }
        .customer-section { 
            background: white; 
            margin: 20px 0; 
            border-radius: 12px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.08); 
            overflow: hidden; 
        }
        
        table { width: 100%; border-collapse: collapse; table-layout: auto; word-wrap: break-word; }
        th { 
            background: #fafafa; 
            padding: 12px 15px; 
            text-align: left; 
            font-size: 0.85rem; 
            color: #6b7280; 
            font-weight: 600; 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
        }
        td { 
            padding: 14px 15px; 
            border-bottom: 1px solid #f3f4f6; 
            color: #374151; 
        }
        
        tr.expandable { cursor: pointer; }
        tr.expandable:hover td { background: #f9fafb; }
        
        .expand-indicator { 
            display: inline-block; 
            margin-right: 8px; 
            transition: transform 0.3s; 
            color: #7c3aed; 
        }
        tr.expanded .expand-indicator { transform: rotate(90deg); }
        
        .status { 
            padding: 5px 10px; 
            border-radius: 6px; 
            font-size: 0.8rem; 
            font-weight: 500; 
        }
        .status-complete { background: #d1fae5; color: #065f46; }
        .status-open { background: #fef3c7; color: #92400e; }
        .status-progress { background: #dbeafe; color: #1e40af; }
        .status-default { background: #f3f4f6; color: #6b7280; }
        
        
        .ai-error-box {
            background: #fef2f2;
            border-left: 4px solid #ef4444;
            padding: 12px;
            margin-top: 8px;
            border-radius: 4px;
            font-size: 0.95rem;
        }
        
        .slack-indicator {
            display: inline-block;
            padding: 3px 8px;
            background: #4a1d96;
            color: white;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-left: 8px;
        }
        
        /* Clean Code Block Styling */
        .code-block-wrapper {
            margin: 20px 0;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            background: #ffffff;
            max-width: 100%;
            width: 100%;
            box-sizing: border-box;
        }

        .code-header {
            background: linear-gradient(135deg, #374151 0%, #4b5563 100%);
            color: #f9fafb;
            padding: 12px 20px;
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.5px;
            border-bottom: 1px solid #6b7280;
        }

        .code-block {
            margin: 0;
            padding: 20px;
            background: #1f2937;
            overflow: hidden;
            max-width: 100%;
            word-wrap: break-word;
            box-sizing: border-box;
        }

        .code-block code {
            color: #f3f4f6;
            font-family: 'SF Mono', 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
            white-space: pre-wrap;
            word-break: break-all;
            overflow-wrap: break-word;
            display: block;
            max-width: 100%;
        }

        /* Clean Inline Code */
        .inline-code {
            background: #fef2f2;
            color: #dc2626;
            padding: 4px 8px;
            border-radius: 6px;
            font-family: 'SF Mono', 'Consolas', monospace;
            font-size: 0.9em;
            font-weight: 600;
            white-space: nowrap;
            border: 1px solid #fecaca;
        }

        /* Link Styles */
        .markdown-link {
            color: #2563eb;
            text-decoration: none;
            font-weight: 500;
            padding: 4px 8px;
            border-radius: 4px;
            background: #eff6ff;
            border: 1px solid #dbeafe;
            transition: all 0.2s;
            display: inline-block;
        }

        .markdown-link:hover {
            color: #1d4ed8;
            background: #dbeafe;
            border-color: #2563eb;
            transform: translateY(-1px);
        }

        .auto-link {
            color: #7c3aed;
            text-decoration: none;
            font-size: 0.95em;
            word-break: break-all;
            padding: 3px 6px;
            border-radius: 4px;
            background: #f3e8ff;
            border: 1px solid #d8b4fe;
        }

        .auto-link:hover {
            color: #5b21b6;
            background: #e9d5ff;
        }

        /* RCA Content Box */
        .rca-content-box {
            padding: 16px;
            background: #f0fdf4;
            border-left: 4px solid #10b981;
            border-radius: 8px;
            font-size: 0.95rem;
            line-height: 1.7;
            color: #1f2937;
            min-height: 60px;
        }

        .rca-content-box .code-block-wrapper {
            margin: 16px 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .rca-empty {
            color: #9ca3af;
            font-style: italic;
            padding: 20px;
            text-align: center;
            background: #f9fafb;
            border: 2px dashed #e5e7eb;
            border-radius: 6px;
        }

        /* Original pre styling for non-code blocks */
        pre {
            background: linear-gradient(135deg, #f8f9fa 0%, #f1f3f4 100%);
            border: 1px solid #d1d5db;
            border-left: 4px solid #7c3aed;
            border-radius: 8px;
            padding: 20px;
            margin: 16px 0;
            overflow-x: auto;
            font-size: 0.85rem;
            line-height: 1.5;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            position: relative;
        }
        
        /* Clean code blocks without content labels */
        
        code {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            background: #e5e7eb;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 0.9em;
            color: #dc2626;
            font-weight: 500;
        }
        
        pre code {
            background: none;
            padding: 0;
            border-radius: 0;
            color: #1f2937;
            font-weight: 400;
            display: block;
            margin-top: 8px;
        }
        
        /* Enhanced syntax highlighting */
        .language-bash code,
        .language-shell code,
        .language-console code {
            color: #059669;
            font-weight: 500;
        }
        
        .language-log code,
        .language-text code {
            color: #374151;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .language-json code {
            color: #0891b2;
        }
        
        .language-yaml code,
        .language-yml code {
            color: #ea580c;
        }
        
        /* Download Button Styling */
        .download-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .download-btn, .share-btn {
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 16px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 120px;
        }

        .share-btn {
            background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(124, 58, 237, 0.4);
            background: linear-gradient(135deg, #6d28d9 0%, #9333ea 100%);
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
        }
        
        .download-icon {
            font-size: 1.1rem;
        }
        
        
        /* Comprehensive Print Styles for PDF Generation */
        @media print {
            /* Page setup for proper PDF sizing */
            @page {
                size: A4;
                margin: 10mm 15mm 10mm 15mm;
            }
            
            /* CRITICAL: Force all hidden content to show when printing */
            * {
                overflow: visible !important;
            }
            
            /* Reset body for print */
            body {
                margin: 0;
                padding: 0;
                font-size: 10pt !important;
                line-height: 1.3 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            /* Scale down the entire content to fit */
            .header {
                padding: 15px 20px !important;
                page-break-after: avoid;
                break-after: avoid;
            }
            
            .header-content {
                max-width: 100% !important;
                font-size: 0.9em !important;
            }
            
            .logo-text {
                font-size: 1.3rem !important;
            }
            
            .report-title {
                font-size: 1.1rem !important;
            }
            
            .stat-number {
                font-size: 1.3rem !important;
            }
            
            /* Hide interactive elements */
            .download-container,
            .search-section {
                display: none !important;
            }
            
            /* Adjust container for print */
            .container {
                max-width: 100% !important;
                padding: 10px !important;
                margin: 0 !important;
            }
            
            /* Ensure tables fit on page */
            .customer-section {
                page-break-inside: avoid;
                break-inside: avoid;
                margin: 10px 0 !important;
            }
            
            table {
                width: 100% !important;
                font-size: 0.85em !important;
            }
            
            th, td {
                padding: 8px 10px !important;
                font-size: 0.85em !important;
            }
            
            /* Force all ticket details to be visible when printing */
            tr[id^="details_"] {
                display: table-row !important;
                visibility: visible !important;
                opacity: 1 !important;
                page-break-inside: avoid;
            }
            
            /* Override any inline styles */
            tr[style*="display: none"] {
                display: table-row !important;
            }
            
            /* Adjust expanded content for print */
            tr[id^="details_"] > td > div {
                padding: 15px 30px !important;
            }
            
            /* Make code blocks smaller but readable */
            pre {
                padding: 10px !important;
                margin: 8px 0 !important;
                font-size: 0.75em !important;
                page-break-inside: avoid;
                max-width: 100% !important;
                overflow: visible !important;
                white-space: pre-wrap !important;
                word-wrap: break-word !important;
            }
            
            pre code {
                font-size: 0.85em !important;
                white-space: pre-wrap !important;
                word-break: break-word !important;
            }
            
            /* Ensure all sections and content are visible */
            .expand-indicator {
                display: none !important;
            }
            
            /* Force all collapsed content to be visible */
            [style*="display: none"],
            [style*="display:none"] {
                display: block !important;
            }
            
            /* Ensure detail rows are visible */
            tr[id*="details"] {
                display: table-row !important;
            }
            
            /* Make sure all RCA content sections are visible */
            div[style*="background: #f9fafb"] {
                display: block !important;
                visibility: visible !important;
            }
            
            /* Adjust section headers */
            h2 {
                font-size: 1.2em !important;
                margin: 10px 0 !important;
                page-break-after: avoid;
            }
            
            h4 {
                font-size: 1em !important;
                margin: 8px 0 !important;
                page-break-after: avoid;
            }
            
            /* Ensure content boxes fit */
            div[style*="padding: 12px"] {
                padding: 8px !important;
                margin: 5px 0 !important;
            }
            
            /* Prevent page breaks in critical areas */
            .customer-section > div:first-child,
            .customer-section table {
                page-break-after: avoid;
            }
            
            /* Scale down any oversized content */
            * {
                max-width: 100% !important;
            }
            
            /* Ensure background colors print */
            .status,
            .ai-badge,
            pre {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
        }
        
        /* Special styling for error logs */
        pre:has(code:contains("error")),
        pre:has(code:contains("Error")),
        pre:has(code:contains("GRPC error")) {
            border-left-color: #dc2626;
            background: linear-gradient(135deg, #fef2f2 0%, #fef7f7 100%);
        }
        
        /* Removed error log labels */
        
        /* Special styling for mount/config logs */
        pre:has(code:contains("mount")),
        pre:has(code:contains("Mount")) {
            border-left-color: #f59e0b;
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
        }
        
        /* Removed mount log labels */
        
        /* Special styling for Java/JVM parameters */
        pre:has(code:contains("-server")),
        pre:has(code:contains("-Xms")) {
            border-left-color: #7c3aed;
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
        }
        
        /* Removed Java config labels */
    </style>
</head>
<body>
    <!-- Download and Share Buttons -->
    <div class="download-container">
        <button class="download-btn" onclick="window.print()" title="Print / Save as PDF">
            <span class="download-icon">🖨️</span>
            <span>Print</span>
        </button>
        <button class="share-btn" onclick="shareReport(); console.log('Button clicked!');" title="Share Report Link">
            <span class="share-icon">🔗</span>
            <span>Share Link</span>
        </button>
    </div>

    <!-- Share Modal -->
    <div id="shareModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
                                background:rgba(0,0,0,0.5); z-index:10000;">
        <div style="background:white; border-radius:12px; padding:25px; max-width:500px;
                    width:90%; max-height:80vh; overflow:auto; position:fixed;
                    top:50%; left:50%; transform:translate(-50%, -50%);">
            <button onclick="closeShareModal()"
                    style="position:absolute; top:15px; right:15px; background:none;
                           border:none; font-size:24px; cursor:pointer; color:#6b7280;">×</button>
            <h3 style="margin:0 0 20px 0; color:#374151;">Share RCA Report</h3>

            <div style="margin-bottom:20px;">
                <label style="display:block; margin-bottom:8px; color:#6b7280; font-size:14px;">Report Link:</label>
                <div style="display:flex; gap:10px;">
                    <input id="shareUrl" type="text" readonly
                           style="flex:1; padding:10px; border:1px solid #e5e7eb; border-radius:6px;
                                  background:#f9fafb; font-family:monospace; font-size:13px;">
                    <button onclick="copyShareLink()"
                            style="padding:10px 20px; background:#7c3aed; color:white;
                                   border:none; border-radius:6px; cursor:pointer;
                                   font-weight:500; white-space:nowrap;">
                        Copy Link
                    </button>
                </div>
                <div id="copySuccess" style="margin-top:10px; color:#10b981; font-size:14px; display:none;">
                    ✅ Link copied to clipboard!
                </div>
            </div>

            <div style="margin-bottom:20px;">
                <label style="display:block; margin-bottom:12px; color:#6b7280; font-size:14px;">Quick Share:</label>
                <div style="display:grid; grid-template-columns:repeat(2, 1fr); gap:10px;">
                    <button onclick="shareViaEmail()"
                            style="padding:12px; background:#f3f4f6; border:1px solid #e5e7eb;
                                   border-radius:6px; cursor:pointer; display:flex; align-items:center;
                                   justify-content:center; gap:8px; transition:background 0.2s;">
                        <span>📧</span> Email
                    </button>
                    <button onclick="shareViaSlack()"
                            style="padding:12px; background:#f3f4f6; border:1px solid #e5e7eb;
                                   border-radius:6px; cursor:pointer; display:flex; align-items:center;
                                   justify-content:center; gap:8px; transition:background 0.2s;">
                        <span>💬</span> Slack
                    </button>
                    <button onclick="shareViaTeams()"
                            style="padding:12px; background:#f3f4f6; border:1px solid #e5e7eb;
                                   border-radius:6px; cursor:pointer; display:flex; align-items:center;
                                   justify-content:center; gap:8px; transition:background 0.2s;">
                        <span>👥</span> Teams
                    </button>
                    <button onclick="shareViaWhatsApp()"
                            style="padding:12px; background:#f3f4f6; border:1px solid #e5e7eb;
                                   border-radius:6px; cursor:pointer; display:flex; align-items:center;
                                   justify-content:center; gap:8px; transition:background 0.2s;">
                        <span>💬</span> WhatsApp
                    </button>
                </div>
            </div>

            <div style="padding:15px; background:#f0f9ff; border:1px solid #bae6fd;
                        border-radius:6px; margin-top:20px;">
                <p style="margin:0; color:#0369a1; font-size:14px; line-height:1.5;">
                    💡 <strong>Tip:</strong> This report can be opened directly in any browser.
                    The recipient will see the full interactive report with all features.
                </p>
            </div>
        </div>
    </div>
    <div class="header">
        <div class="header-content">
            <div class="header-left">
                <div class="logo-section">
                    <div class="logo-text">
                        <span style="color: white;">Facets</span>
                        <span class="logo-dot">.</span>
                        <span class="logo-cloud">cloud</span>
                    </div>
                    <div class="divider"></div>
                    <div class="report-title">
                        RCA Report
                        <span class="ai-badge">✨ AI Enhanced</span>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <div>
                    <div class="date-info">📅 Sep 30 - Oct 01, 2025</div>
                    <div class="date-info" style="margin-top: 5px;">Specific tickets</div>
                </div>
                <div class="stats">
                    <div class="stat">
                        <div class="stat-number">1</div>
                        <div class="stat-label">Total Tickets</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number">1</div>
                        <div class="stat-label">Customers</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="search-section">
        <div class="search-container">
            <input type="text" class="search-input" id="searchInput"
                   placeholder="Search by ticket title, customer name, or status...">
            <button class="search-btn" onclick="performSearch()"
                    style="background: #7c3aed; color: white; padding: 12px 30px;
                           border: none; border-radius: 8px; cursor: pointer; margin: 0 5px;">
                🔍 Search
            </button>
            <button class="clear-btn" onclick="clearSearch()"
                    style="background: #dc2626; color: white; padding: 12px 30px;
                           border: none; border-radius: 8px; cursor: pointer; margin: 0 5px;">
                🔄 Clear
            </button>
        </div>
    </div>
    
    <div class="container">
        <div class="customer-section">
            <div style="background: linear-gradient(135deg, #f8f9fa 0%, #f3f4f6 100%); 
                        padding: 20px 25px; display: flex; justify-content: space-between; align-items: center;">
                <h2>MoveInSync</h2>
                <span style="background: #14b8a6; color: white; padding: 6px 14px; 
                           border-radius: 20px; font-size: 0.85rem; font-weight: 500;">
                    1 tickets
                </span>
            </div>
            <table>
                <tr>
                    <th width="50">#</th>
                    <th>Title</th>
                    <th width="120">ClickUp</th>
                    <th width="100">Date</th>
                    <th width="120">Status</th>
                    <th width="150">Owner</th>
                </tr>
                <tr class="expandable" onclick="toggleDetails('MoveInSync_1')">
                    <td><span class="expand-indicator">▶</span> 1</td>
                    <td>Unable to attach EFS to pod</td>
                    <td><a href="https://app.clickup.com/t/86d09jha0" 
                           style="color: #7c3aed; text-decoration: none; padding: 5px 12px; 
                                  border: 1px solid #7c3aed; border-radius: 6px; display: inline-block; font-size: 0.85rem;"
                           target="_blank" onclick="event.stopPropagation()">View</a></td>
                    <td>2025-09-11</td>
                    <td><span class="status status-default">customer side fix</span></td>
                    <td>Rauneet Verma</td>
                </tr>
                <tr id="details_MoveInSync_1" style="display: none;">
                    <td colspan="6" style="padding: 0;">
                        <div style="background: #f9fafb; padding: 20px 60px; border-left: 4px solid #7c3aed;">
                            
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 25px; 
                                        padding: 15px; background: white; border-radius: 6px;">
                                <div><strong>Customer:</strong><br>MoveInSync</div>
                                <div><strong>Date:</strong><br>2025-09-11</div>
                                <div><strong>Status:</strong><br>customer side fix</div>
                                <div><strong>Owner:</strong><br>Rauneet Verma</div>
                                <div><strong>ClickUp ID:</strong><br>86d09jha0</div>
                                <div><strong>Analysis:</strong><br>✅ AI Generated</div>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #1f2937;">📋 Summary of the Issue</h4>
                                <div class="rca-content-box">
                                    The customer, MoveInSync, was attempting to attach an Amazon EFS to a Kubernetes pod within their EKS cluster. The expected outcome was for the EFS to mount successfully, allowing the pod to access the file system. However, the actual result was a failure to mount the EFS, indicated by repeated GRPC errors and mount failures. The error logs showed issues such as unrecognized init systems and connection timeouts. This problem affected the <code class="inline-code">mis-healthlogs</code> pods, which were stuck in a <code class="inline-code">CrashLoopBackOff</code> state, preventing the application from running correctly. The environment involved AWS EFS and EKS, with specific attention to the EFS CSI driver and security group configurations.<br>
                                </div>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #1f2937;">🔍 Steps to Debug</h4>
                                <div class="rca-content-box">
                                    1. Rauneet Verma observed repeated GRPC errors indicating mount failures for the EFS:<br><br>
   <div class="code-block-wrapper">
<div class="code-header">📝 BASH</div>
<pre class="code-block"><code>E0911 12:34:25.781867       1 driver.go:107] GRPC error: rpc error: code = Internal desc = Could not mount &quot;fs-079fbe5bbe7a6b2cf:/&quot; at &quot;/var/lib/kubelet/pods/b352cf58-adc1-4e3f-a02b-eb8633a834d4/volumes/kubernetes.io~csi/healthlog-service-pv/mount&quot;: mount failed: exit status 32</code></pre>
</div>
   This indicated a failure in the EFS mounting process.<br><br>

2. The mounting command and arguments were reviewed, revealing issues with the EFS CSI driver:<br><br>
   <div class="code-block-wrapper">
<div class="code-header">📝 BASH</div>
<pre class="code-block"><code>Mounting arguments: -t efs -o tls fs-079fbe5bbe7a6b2cf:/ /var/lib/kubelet/pods/b352cf58-adc1-4e3f-a02b-eb8633a834d4/volumes/kubernetes.io~csi/healthlog-service-pv/mount
   Output: Could not start amazon-efs-mount-watchdog, unrecognized init system &quot;aws-efs-csi-dri&quot;</code></pre><br>
</div>
   This suggested a configuration or compatibility issue with the EFS CSI driver.<br><br>

3. Rauneet noted the <code class="inline-code">mis-healthlogs</code> pods were in a <code class="inline-code">CrashLoopBackOff</code> state, indicating persistent startup failures:<br>
   <div class="code-block-wrapper">
<div class="code-header">📝 CODE</div>
<pre class="code-block"><code>Now i can see that the mis-healthlogs is in CrashloopBackOff
   mis-healthlogs-56fd8696fd-256hz                                   0/1     CrashLoopBackOff    8 (3m28s ago)      114m</code></pre><br>
</div>
   This was a critical symptom of the underlying issue.<br><br>

4. Security group configurations were checked to ensure NFS traffic was allowed:<br><br>
   <div class="code-block-wrapper">
<div class="code-header">📝 CODE</div>
<pre class="code-block"><code>Check EFS Security Groups: Ensure the EFS file system fs-079fbe5bbe7a6b2cf has proper security group rules allowing NFS traffic (port 2049) from the EKS worker nodes.</code></pre>
</div>
   This step was crucial to verify network permissions were not blocking the mount process.<br><br>
                                </div>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #1f2937;">✅ Steps to Resolution</h4>
                                <div class="rca-content-box">
                                    1. It was suggested to restart the EFS CSI node pod to resolve potential configuration issues:<br><br>
   <div class="code-block-wrapper">
<div class="code-header">📝 CODE</div>
<pre class="code-block"><code>EFS CSI Driver Issue: The EFS CSI node pod may need to be restarted to resolve configuration issues.</code></pre>
</div>
   This action was aimed at refreshing the driver configuration and resolving any transient issues.<br><br>

2. The customer was advised to update the EFS utils configuration file to include missing parameters:<br><br>
   <div class="code-block-wrapper">
<div class="code-header">📝 CODE</div>
<pre class="code-block"><code>Warning: config file does not have fips_mode_enabled item in section mount.. You should be able to find a new config file in the same folder as current config file /etc/amazon/efs/efs-utils.conf. Consider update the new config file to latest config file. Use the default value [fips_mode_enabled = False].</code></pre>
</div>
   This step was necessary to ensure the configuration was up-to-date and compatible with the current system setup.<br><br>

3. The customer was guided to verify that EFS mount targets existed in the same availability zone as the node:<br><br>
   <div class="code-block-wrapper">
<div class="code-header">📝 CODE</div>
<pre class="code-block"><code>Verify EFS mount targets exist in the same AZ as the node.</code></pre>
</div>
   Ensuring the mount targets are correctly configured is essential for successful EFS mounting.<br><br>
                                </div>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #1f2937;">🎯 Root Cause Analysis</h4>
                                <div class="rca-content-box">
                                    The issue appears to be related to a combination of configuration and compatibility problems with the EFS CSI driver and the EFS utils configuration. The GRPC errors and mount failures were likely due to an unrecognized init system and missing configuration parameters in the EFS utils. Additionally, network permissions needed verification to ensure NFS traffic was allowed. The <code class="inline-code">CrashLoopBackOff</code> state of the pods suggested persistent startup issues, potentially exacerbated by these configuration problems. Further investigation into the EFS CSI driver setup and security group rules was necessary to confirm the root cause.<br>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr></table></div>
    </div>
    
    <script>
        // Ensure all details are expanded when printing
        window.addEventListener('beforeprint', function() {
            // Expand all detail rows before printing
            const detailRows = document.querySelectorAll('[id^="details_"]');
            detailRows.forEach(row => {
                row.style.display = 'table-row';
            });
            
            // Hide expand indicators
            const indicators = document.querySelectorAll('.expand-indicator');
            indicators.forEach(indicator => {
                indicator.style.display = 'none';
            });
        });
        
        // Optional: Restore collapsed state after printing (commented out to keep expanded)
        // window.addEventListener('afterprint', function() {
        //     const detailRows = document.querySelectorAll('[id^="details_"]');
        //     detailRows.forEach(row => {
        //         row.style.display = 'none';
        //     });
        // });
        
        function toggleDetails(ticketId) {
            const detailsRow = document.getElementById('details_' + ticketId);
            const clickedRow = detailsRow.previousElementSibling;
            const indicator = clickedRow.querySelector('.expand-indicator');
            
            if (detailsRow.style.display === 'table-row') {
                detailsRow.style.display = 'none';
                indicator.innerHTML = '▶';
                clickedRow.classList.remove('expanded');
            } else {
                // Close all other expanded rows
                document.querySelectorAll('[id^="details_"]').forEach(row => {
                    row.style.display = 'none';
                    if (row.previousElementSibling) {
                        row.previousElementSibling.classList.remove('expanded');
                        row.previousElementSibling.querySelector('.expand-indicator').innerHTML = '▶';
                    }
                });
                
                detailsRow.style.display = 'table-row';
                indicator.innerHTML = '▼';
                clickedRow.classList.add('expanded');
            }
        }
        
        let lastEnterTime = 0;

        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            const sections = document.querySelectorAll('.customer-section');
            let totalVisible = 0;

            sections.forEach(section => {
                const customerName = section.querySelector('h2').textContent.toLowerCase();
                const rows = section.querySelectorAll('tr.expandable');
                let hasVisibleRows = false;

                rows.forEach(row => {
                    const cells = row.cells;
                    const title = cells[1] ? cells[1].textContent.toLowerCase() : '';
                    const clickupId = cells[2] ? cells[2].textContent.toLowerCase() : '';
                    const date = cells[3] ? cells[3].textContent.toLowerCase() : '';
                    const status = cells[4] ? cells[4].textContent.toLowerCase() : '';
                    const owner = cells[5] ? cells[5].textContent.toLowerCase() : '';

                    const shouldShow = searchTerm === '' ||
                                     title.includes(searchTerm) ||
                                     customerName.includes(searchTerm) ||
                                     clickupId.includes(searchTerm) ||
                                     date.includes(searchTerm) ||
                                     status.includes(searchTerm) ||
                                     owner.includes(searchTerm);

                    row.style.display = shouldShow ? '' : 'none';
                    if (shouldShow) {
                        hasVisibleRows = true;
                        totalVisible++;
                    }

                    // Hide details row if main row is hidden
                    const detailsRow = row.nextElementSibling;
                    if (detailsRow && detailsRow.id && detailsRow.id.startsWith('details_')) {
                        detailsRow.style.display = shouldShow ? '' : 'none';
                    }
                });

                section.style.display = hasVisibleRows ? '' : 'none';
            });

            updateSearchStatus(searchTerm ? `Found ${totalVisible} result(s)` : '');
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            performSearch();
            updateSearchStatus('Search cleared');
        }

        function updateSearchStatus(message) {
            let statusDiv = document.getElementById('searchStatus');
            if (!statusDiv) {
                statusDiv = document.createElement('div');
                statusDiv.id = 'searchStatus';
                statusDiv.style.cssText = 'text-align: center; padding: 10px; color: #7c3aed; font-size: 14px;';
                document.querySelector('.search-section').appendChild(statusDiv);
            }
            statusDiv.textContent = message;
            if (message) {
                setTimeout(() => { statusDiv.textContent = ''; }, 2000);
            }
        }
        
        // Enhanced keyboard support
        document.getElementById('searchInput').addEventListener('keyup', function(event) {
            const currentTime = Date.now();

            if (event.key === 'Enter') {
                if (this.value === '' && currentTime - lastEnterTime < 500) {
                    // Double-Enter on empty field clears any filters
                    clearSearch();
                    lastEnterTime = 0;
                } else {
                    performSearch();
                    lastEnterTime = currentTime;
                }
            } else if (event.key === 'Escape') {
                clearSearch();
            }
        });

        // Real-time search as you type
        document.getElementById('searchInput').addEventListener('input', function() {
            performSearch();
        });

        // Clear on double-click
        document.getElementById('searchInput').addEventListener('dblclick', function() {
            clearSearch();
        });

        // Cloud URLs will be injected here after upload
        window.reportCloudUrls = {"github_repo": {"repo_url": "https://github.com/AbhisHub-12/RCA-REPORTS/blob/main/2025/October/RCA_Report_20251001_123326.html", "raw_url": "https://raw.githubusercontent.com/AbhisHub-12/RCA-REPORTS/main/2025/October/RCA_Report_20251001_123326.html", "preview_url": "https://htmlpreview.github.io/?https://raw.githubusercontent.com/AbhisHub-12/RCA-REPORTS/main/2025/October/RCA_Report_20251001_123326.html", "github_pages_url": "https://abhishub-12.github.io/RCA-REPORTS/2025/October/RCA_Report_20251001_123326.html", "path": "2025/October/RCA_Report_20251001_123326.html", "sha": "45ee6469e3d6108346f873e9786185dd44c8d340"}, "github_gist": {"gist_url": "https://gist.github.com/AbhisHub-12/df88857303113a02e7dbfa8469078d0a", "preview_url": "https://htmlpreview.github.io/?https://gist.githubusercontent.com/AbhisHub-12/df88857303113a02e7dbfa8469078d0a/raw/RCA_Report_20251001_123326.html", "raw_url": "https://gist.githubusercontent.com/AbhisHub-12/df88857303113a02e7dbfa8469078d0a/raw/RCA_Report_20251001_123326.html"}};

        // Share functionality
        function shareReport() {
            console.log('Share button clicked!'); // Debug log

            const modal = document.getElementById('shareModal');
            const urlInput = document.getElementById('shareUrl');

            if (!modal) {
                console.error('Share modal not found!');
                alert('Error: Share modal not found. Please refresh the page.');
                return;
            }

            if (!urlInput) {
                console.error('Share URL input not found!');
                alert('Error: Share URL input not found. Please refresh the page.');
                return;
            }

            // Get the current page URL (or use the cloud URL if available)
            let shareUrl = window.location.href;

            // Check if we have cloud URLs stored in the page
            const cloudUrls = window.reportCloudUrls || {};
            console.log('Available cloud URLs:', cloudUrls); // Debug log

            // Prefer GitHub Pages, then Gist, then regular preview, then transfer.sh, then local
            if (cloudUrls.github_repo && cloudUrls.github_repo.github_pages_url) {
                shareUrl = cloudUrls.github_repo.github_pages_url;
                console.log('Using GitHub Pages URL (best option)');
            } else if (cloudUrls.github_gist && cloudUrls.github_gist.preview_url) {
                shareUrl = cloudUrls.github_gist.preview_url;
                console.log('Using GitHub gist preview URL');
            } else if (cloudUrls.github_repo && cloudUrls.github_repo.preview_url) {
                shareUrl = cloudUrls.github_repo.preview_url;
                console.log('Using GitHub repo preview URL (limited JavaScript)');
            } else if (cloudUrls.transfer_sh) {
                shareUrl = cloudUrls.transfer_sh;
                console.log('Using transfer.sh URL');
            } else {
                console.log('Using local file URL');
            }

            urlInput.value = shareUrl;
            modal.style.display = 'block';
            console.log('Modal should now be visible'); // Debug log
        }

        function closeShareModal() {
            document.getElementById('shareModal').style.display = 'none';
            document.getElementById('copySuccess').style.display = 'none';
        }

        function copyShareLink() {
            const urlInput = document.getElementById('shareUrl');
            const copySuccess = document.getElementById('copySuccess');

            // Select and copy the text
            urlInput.select();
            urlInput.setSelectionRange(0, 99999); // For mobile devices

            try {
                document.execCommand('copy');
                copySuccess.style.display = 'block';

                // Hide success message after 3 seconds
                setTimeout(() => {
                    copySuccess.style.display = 'none';
                }, 3000);
            } catch (err) {
                // Fallback for modern browsers
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(urlInput.value).then(() => {
                        copySuccess.style.display = 'block';
                        setTimeout(() => {
                            copySuccess.style.display = 'none';
                        }, 3000);
                    });
                }
            }
        }

        function shareViaEmail() {
            const url = document.getElementById('shareUrl').value;
            const subject = encodeURIComponent('RCA Report - ' + document.title);
            const body = encodeURIComponent('Here is the RCA report:\\n\\n' + url);
            window.location.href = 'mailto:?subject=' + subject + '&body=' + body;
        }

        function shareViaSlack() {
            const url = document.getElementById('shareUrl').value;
            const text = encodeURIComponent('RCA Report: ' + url);
            // Open Slack's share URL (user needs to be logged in)
            window.open('https://slack.com/intl/en-in/share?url=' + encodeURIComponent(url), '_blank');
        }

        function shareViaTeams() {
            const url = document.getElementById('shareUrl').value;
            const text = encodeURIComponent('Check out this RCA Report');
            // Open Teams share dialog
            window.open('https://teams.microsoft.com/share?href=' + encodeURIComponent(url) + '&text=' + text, '_blank');
        }

        function shareViaWhatsApp() {
            const url = document.getElementById('shareUrl').value;
            const text = encodeURIComponent('RCA Report: ' + url);
            // Open WhatsApp with pre-filled message
            window.open('https://wa.me/?text=' + text, '_blank');
        }

        // Close modal when clicking outside
        document.getElementById('shareModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeShareModal();
            }
        });

        // Add keyboard shortcut for share (Ctrl+Shift+S)
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'S') {
                e.preventDefault();
                shareReport();
            }
        });

        // Validate all functions are loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('✅ DOM Content Loaded');
            console.log('✅ ShareReport function:', typeof shareReport);
            console.log('✅ ToggleDetails function:', typeof toggleDetails);
            console.log('✅ Share modal element:', document.getElementById('shareModal') ? 'Found' : 'Not Found');
            console.log('✅ Cloud URLs:', window.reportCloudUrls);
        });
    </script>
</body>
</html>
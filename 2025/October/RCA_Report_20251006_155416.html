<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RCA Report - Capillary - Last 7 days</title>
    <style>
        body { font-family: -apple-system, Arial, sans-serif; margin: 0; background: #f8f9fa; }
        
        .header { 
            background: linear-gradient(135deg, #7c3aed 0%, #14b8a6 100%); 
            color: white; 
            padding: 25px 40px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 30px;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 25px;
        }
        
        .logo-text {
            font-size: 2rem;
            font-weight: bold;
            display: flex;
            align-items: baseline;
        }
        
        .logo-dot { color: #14b8a6; font-size: 2.5rem; margin: 0 2px; }
        .logo-cloud { color: #14b8a6; }
        
        .divider {
            width: 2px;
            height: 40px;
            background: rgba(255,255,255,0.3);
        }
        
        .report-title {
            font-size: 1.5rem;
            font-weight: 300;
        }
        
        .header-right { display: flex; align-items: center; gap: 40px; }
        .date-info { font-size: 0.95rem; opacity: 0.9; }
        .stats { display: flex; gap: 30px; }
        .stat { text-align: center; }
        .stat-number { font-size: 1.8rem; font-weight: bold; color: #14b8a6; }
        .stat-label { font-size: 0.75rem; opacity: 0.85; text-transform: uppercase; letter-spacing: 0.5px; margin-top: 2px; }
        
        .ai-badge {
            background: #10b981;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
            margin-left: 10px;
        }
        
        .search-section {
            background: white;
            padding: 25px;
            margin: 30px auto;
            max-width: 1400px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .search-container { display: flex; gap: 15px; align-items: center; }
        .search-input { 
            flex: 1; 
            padding: 12px 20px; 
            border: 2px solid #e2e8f0; 
            border-radius: 8px; 
            font-size: 1rem; 
            outline: none; 
        }
        .search-input:focus { 
            border-color: #7c3aed; 
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1); 
        }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 0 20px 40px; }
        .customer-section { 
            background: white; 
            margin: 20px 0; 
            border-radius: 12px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.08); 
            overflow: hidden; 
        }
        
        table { width: 100%; border-collapse: collapse; table-layout: auto; word-wrap: break-word; }
        th { 
            background: #fafafa; 
            padding: 12px 15px; 
            text-align: left; 
            font-size: 0.85rem; 
            color: #6b7280; 
            font-weight: 600; 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
        }
        td { 
            padding: 14px 15px; 
            border-bottom: 1px solid #f3f4f6; 
            color: #374151; 
        }
        
        tr.expandable { cursor: pointer; }
        tr.expandable:hover td { background: #f9fafb; }
        
        .expand-indicator { 
            display: inline-block; 
            margin-right: 8px; 
            transition: transform 0.3s; 
            color: #7c3aed; 
        }
        tr.expanded .expand-indicator { transform: rotate(90deg); }
        
        .status { 
            padding: 5px 10px; 
            border-radius: 6px; 
            font-size: 0.8rem; 
            font-weight: 500; 
        }
        .status-complete { background: #d1fae5; color: #065f46; }
        .status-open { background: #fef3c7; color: #92400e; }
        .status-progress { background: #dbeafe; color: #1e40af; }
        .status-default { background: #f3f4f6; color: #6b7280; }
        
        
        .ai-error-box {
            background: #fef2f2;
            border-left: 4px solid #ef4444;
            padding: 12px;
            margin-top: 8px;
            border-radius: 4px;
            font-size: 0.95rem;
        }
        
        .slack-indicator {
            display: inline-block;
            padding: 3px 8px;
            background: #4a1d96;
            color: white;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-left: 8px;
        }
        
        /* Clean Code Block Styling */
        .code-block-wrapper {
            margin: 20px 0;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            background: #ffffff;
            max-width: 100%;
            width: 100%;
            box-sizing: border-box;
        }

        .code-header {
            background: linear-gradient(135deg, #374151 0%, #4b5563 100%);
            color: #f9fafb;
            padding: 12px 20px;
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.5px;
            border-bottom: 1px solid #6b7280;
        }

        .code-block {
            margin: 0;
            padding: 20px;
            background: #1f2937;
            overflow: hidden;
            max-width: 100%;
            word-wrap: break-word;
            box-sizing: border-box;
        }

        .code-block code {
            color: #f3f4f6;
            font-family: 'SF Mono', 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
            white-space: pre-wrap;
            word-break: break-all;
            overflow-wrap: break-word;
            display: block;
            max-width: 100%;
        }

        /* Clean Inline Code */
        .inline-code {
            background: #fef2f2;
            color: #dc2626;
            padding: 4px 8px;
            border-radius: 6px;
            font-family: 'SF Mono', 'Consolas', monospace;
            font-size: 0.9em;
            font-weight: 600;
            white-space: nowrap;
            border: 1px solid #fecaca;
        }

        /* Link Styles */
        .markdown-link {
            color: #2563eb;
            text-decoration: none;
            font-weight: 500;
            padding: 4px 8px;
            border-radius: 4px;
            background: #eff6ff;
            border: 1px solid #dbeafe;
            transition: all 0.2s;
            display: inline-block;
        }

        .markdown-link:hover {
            color: #1d4ed8;
            background: #dbeafe;
            border-color: #2563eb;
            transform: translateY(-1px);
        }

        .auto-link {
            color: #7c3aed;
            text-decoration: none;
            font-size: 0.95em;
            word-break: break-all;
            padding: 3px 6px;
            border-radius: 4px;
            background: #f3e8ff;
            border: 1px solid #d8b4fe;
        }

        .auto-link:hover {
            color: #5b21b6;
            background: #e9d5ff;
        }

        /* RCA Content Box */
        .rca-content-box {
            padding: 16px;
            background: #f0fdf4;
            border-left: 4px solid #10b981;
            border-radius: 8px;
            font-size: 0.95rem;
            line-height: 1.7;
            color: #1f2937;
            min-height: 60px;
        }

        .rca-content-box .code-block-wrapper {
            margin: 16px 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .rca-empty {
            color: #9ca3af;
            font-style: italic;
            padding: 20px;
            text-align: center;
            background: #f9fafb;
            border: 2px dashed #e5e7eb;
            border-radius: 6px;
        }

        /* Original pre styling for non-code blocks */
        pre {
            background: linear-gradient(135deg, #f8f9fa 0%, #f1f3f4 100%);
            border: 1px solid #d1d5db;
            border-left: 4px solid #7c3aed;
            border-radius: 8px;
            padding: 20px;
            margin: 16px 0;
            overflow-x: auto;
            font-size: 0.85rem;
            line-height: 1.5;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            position: relative;
        }
        
        /* Clean code blocks without content labels */
        
        code {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            background: #e5e7eb;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 0.9em;
            color: #dc2626;
            font-weight: 500;
        }
        
        pre code {
            background: none;
            padding: 0;
            border-radius: 0;
            color: #1f2937;
            font-weight: 400;
            display: block;
            margin-top: 8px;
        }
        
        /* Enhanced syntax highlighting */
        .language-bash code,
        .language-shell code,
        .language-console code {
            color: #059669;
            font-weight: 500;
        }
        
        .language-log code,
        .language-text code {
            color: #374151;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .language-json code {
            color: #0891b2;
        }
        
        .language-yaml code,
        .language-yml code {
            color: #ea580c;
        }
        
        /* Download Button Styling */
        .download-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .download-btn, .share-btn {
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 16px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 120px;
        }

        .share-btn {
            background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(124, 58, 237, 0.4);
            background: linear-gradient(135deg, #6d28d9 0%, #9333ea 100%);
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
        }
        
        .download-icon {
            font-size: 1.1rem;
        }
        
        
        /* Comprehensive Print Styles for PDF Generation */
        @media print {
            /* Page setup for proper PDF sizing */
            @page {
                size: A4;
                margin: 10mm 15mm 10mm 15mm;
            }
            
            /* CRITICAL: Force all hidden content to show when printing */
            * {
                overflow: visible !important;
            }
            
            /* Reset body for print */
            body {
                margin: 0;
                padding: 0;
                font-size: 10pt !important;
                line-height: 1.3 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            /* Scale down the entire content to fit */
            .header {
                padding: 15px 20px !important;
                page-break-after: avoid;
                break-after: avoid;
            }
            
            .header-content {
                max-width: 100% !important;
                font-size: 0.9em !important;
            }
            
            .logo-text {
                font-size: 1.3rem !important;
            }
            
            .report-title {
                font-size: 1.1rem !important;
            }
            
            .stat-number {
                font-size: 1.3rem !important;
            }
            
            /* Hide interactive elements */
            .download-container,
            .search-section {
                display: none !important;
            }
            
            /* Adjust container for print */
            .container {
                max-width: 100% !important;
                padding: 10px !important;
                margin: 0 !important;
            }
            
            /* Ensure tables fit on page */
            .customer-section {
                page-break-inside: avoid;
                break-inside: avoid;
                margin: 10px 0 !important;
            }
            
            table {
                width: 100% !important;
                font-size: 0.85em !important;
            }
            
            th, td {
                padding: 8px 10px !important;
                font-size: 0.85em !important;
            }
            
            /* Force all ticket details to be visible when printing */
            tr[id^="details_"] {
                display: table-row !important;
                visibility: visible !important;
                opacity: 1 !important;
                page-break-inside: avoid;
            }
            
            /* Override any inline styles */
            tr[style*="display: none"] {
                display: table-row !important;
            }
            
            /* Adjust expanded content for print */
            tr[id^="details_"] > td > div {
                padding: 15px 30px !important;
            }
            
            /* Make code blocks smaller but readable */
            pre {
                padding: 10px !important;
                margin: 8px 0 !important;
                font-size: 0.75em !important;
                page-break-inside: avoid;
                max-width: 100% !important;
                overflow: visible !important;
                white-space: pre-wrap !important;
                word-wrap: break-word !important;
            }
            
            pre code {
                font-size: 0.85em !important;
                white-space: pre-wrap !important;
                word-break: break-word !important;
            }
            
            /* Ensure all sections and content are visible */
            .expand-indicator {
                display: none !important;
            }
            
            /* Force all collapsed content to be visible */
            [style*="display: none"],
            [style*="display:none"] {
                display: block !important;
            }
            
            /* Ensure detail rows are visible */
            tr[id*="details"] {
                display: table-row !important;
            }
            
            /* Make sure all RCA content sections are visible */
            div[style*="background: #f9fafb"] {
                display: block !important;
                visibility: visible !important;
            }
            
            /* Adjust section headers */
            h2 {
                font-size: 1.2em !important;
                margin: 10px 0 !important;
                page-break-after: avoid;
            }
            
            h4 {
                font-size: 1em !important;
                margin: 8px 0 !important;
                page-break-after: avoid;
            }
            
            /* Ensure content boxes fit */
            div[style*="padding: 12px"] {
                padding: 8px !important;
                margin: 5px 0 !important;
            }
            
            /* Prevent page breaks in critical areas */
            .customer-section > div:first-child,
            .customer-section table {
                page-break-after: avoid;
            }
            
            /* Scale down any oversized content */
            * {
                max-width: 100% !important;
            }
            
            /* Ensure background colors print */
            .status,
            .ai-badge,
            pre {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
        }
        
        /* Special styling for error logs */
        pre:has(code:contains("error")),
        pre:has(code:contains("Error")),
        pre:has(code:contains("GRPC error")) {
            border-left-color: #dc2626;
            background: linear-gradient(135deg, #fef2f2 0%, #fef7f7 100%);
        }
        
        /* Removed error log labels */
        
        /* Special styling for mount/config logs */
        pre:has(code:contains("mount")),
        pre:has(code:contains("Mount")) {
            border-left-color: #f59e0b;
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
        }
        
        /* Removed mount log labels */
        
        /* Special styling for Java/JVM parameters */
        pre:has(code:contains("-server")),
        pre:has(code:contains("-Xms")) {
            border-left-color: #7c3aed;
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
        }
        
        /* Removed Java config labels */

        /* Image Viewer Modal Styles */
        .image-viewer-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            cursor: pointer;
        }

        .image-viewer-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 95vw;
            max-height: 95vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .image-viewer-image {
            max-width: 100%;
            max-height: 85vh;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .image-viewer-title {
            color: white;
            background: rgba(0, 0, 0, 0.7);
            padding: 12px 20px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 1rem;
            font-weight: 500;
            text-align: center;
        }

        .image-viewer-close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 35px;
            font-weight: bold;
            cursor: pointer;
            z-index: 10001;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }

        .image-viewer-close:hover {
            background: rgba(0, 0, 0, 0.8);
        }

    </style>
</head>
<body>
    <!-- Download and Share Buttons -->
    <div class="download-container">
        <button class="download-btn" id="printBtn" title="Print / Save as PDF">
            <span class="download-icon">üñ®Ô∏è</span>
            <span>Print</span>
        </button>
        <button class="share-btn" id="shareReportBtn" title="Share Report Link">
            <span class="share-icon">üîó</span>
            <span>Share Link</span>
        </button>
    </div>

    <!-- Share Modal -->
    <div id="shareModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
                                background:rgba(0,0,0,0.5); z-index:10000;">
        <div style="background:white; border-radius:12px; padding:25px; max-width:500px;
                    width:90%; max-height:80vh; overflow:auto; position:fixed;
                    top:50%; left:50%; transform:translate(-50%, -50%);">
            <button id="closeModalBtn"
                    style="position:absolute; top:15px; right:15px; background:none;
                           border:none; font-size:24px; cursor:pointer; color:#6b7280;">√ó</button>
            <h3 style="margin:0 0 20px 0; color:#374151;">Share RCA Report</h3>

            <div style="margin-bottom:20px;">
                <label style="display:block; margin-bottom:8px; color:#6b7280; font-size:14px;">Report Link:</label>
                <div style="display:flex; gap:10px;">
                    <input id="shareUrl" type="text" readonly
                           style="flex:1; padding:10px; border:1px solid #e5e7eb; border-radius:6px;
                                  background:#f9fafb; font-family:monospace; font-size:13px;">
                    <button id="copyLinkBtn"
                            style="padding:10px 20px; background:#7c3aed; color:white;
                                   border:none; border-radius:6px; cursor:pointer;
                                   font-weight:500; white-space:nowrap;">
                        Copy Link
                    </button>
                </div>
                <div id="copySuccess" style="margin-top:10px; color:#10b981; font-size:14px; display:none;">
                    ‚úÖ Link copied to clipboard!
                </div>
            </div>

            <div style="margin-bottom:20px;">
                <label style="display:block; margin-bottom:12px; color:#6b7280; font-size:14px;">Quick Share:</label>
                <div style="display:grid; grid-template-columns:repeat(2, 1fr); gap:10px;">
                    <button id="shareEmailBtn"
                            style="padding:12px; background:#f3f4f6; border:1px solid #e5e7eb;
                                   border-radius:6px; cursor:pointer; display:flex; align-items:center;
                                   justify-content:center; gap:8px; transition:background 0.2s;">
                        <span>üìß</span> Email
                    </button>
                    <button id="shareSlackBtn"
                            style="padding:12px; background:#f3f4f6; border:1px solid #e5e7eb;
                                   border-radius:6px; cursor:pointer; display:flex; align-items:center;
                                   justify-content:center; gap:8px; transition:background 0.2s;">
                        <span>üí¨</span> Slack
                    </button>
                    <button id="shareTeamsBtn"
                            style="padding:12px; background:#f3f4f6; border:1px solid #e5e7eb;
                                   border-radius:6px; cursor:pointer; display:flex; align-items:center;
                                   justify-content:center; gap:8px; transition:background 0.2s;">
                        <span>üë•</span> Teams
                    </button>
                    <button id="shareWhatsAppBtn"
                            style="padding:12px; background:#f3f4f6; border:1px solid #e5e7eb;
                                   border-radius:6px; cursor:pointer; display:flex; align-items:center;
                                   justify-content:center; gap:8px; transition:background 0.2s;">
                        <span>üí¨</span> WhatsApp
                    </button>
                </div>
            </div>

            <div id="backupSection" style="margin-bottom:20px;">
                <label style="display:block; margin-bottom:8px; color:#6b7280; font-size:14px;">Alternative Link (HTML Preview):</label>
                <div style="display:flex; gap:10px;">
                    <input id="shareUrlBackup" type="text" readonly
                           style="flex:1; padding:10px; border:1px solid #e5e7eb; border-radius:6px;
                                  background:#f9fafb; font-family:monospace; font-size:13px;">
                    <button id="copyBackupLinkBtn"
                            style="padding:10px 20px; background:#059669; color:white;
                                   border:none; border-radius:6px; cursor:pointer;
                                   font-weight:500; white-space:nowrap;">
                        Copy Backup
                    </button>
                </div>
                <div style="margin-top:5px; color:#059669; font-size:12px;">
                    ‚úÖ This link works reliably for customer sharing
                </div>
            </div>

            <div style="padding:15px; background:#f0f9ff; border:1px solid #bae6fd;
                        border-radius:6px; margin-top:20px;">
                <p style="margin:0; color:#0369a1; font-size:14px; line-height:1.5;">
                    üí° <strong>Tip:</strong> This report can be opened directly in any browser.
                    The recipient will see the full interactive report with all features.
                </p>
            </div>
        </div>
    </div>

    <!-- Image Viewer Modal -->
    <div id="imageViewerModal" class="image-viewer-modal" onclick="closeImageViewer()">
        <div class="image-viewer-close" onclick="closeImageViewer()">&times;</div>
        <div class="image-viewer-content" onclick="event.stopPropagation()">
            <img id="imageViewerImage" class="image-viewer-image" src="" alt="">
            <div id="imageViewerTitle" class="image-viewer-title"></div>
        </div>
    </div>

    <div class="header">
        <div class="header-content">
            <div class="header-left">
                <div class="logo-section">
                    <div class="logo-text">
                        <span style="color: white;">Facets</span>
                        <span class="logo-dot">.</span>
                        <span class="logo-cloud">cloud</span>
                    </div>
                    <div class="divider"></div>
                    <div class="report-title">
                        RCA Report
                        <span class="ai-badge">‚ú® AI Enhanced</span>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <div>
                    <div class="date-info">üìÖ Sep 29 - Oct 06, 2025</div>
                    <div class="date-info" style="margin-top: 5px;">Capillary - Last 7 days</div>
                </div>
                <div class="stats">
                    <div class="stat">
                        <div class="stat-number">4</div>
                        <div class="stat-label">Total Tickets</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number">1</div>
                        <div class="stat-label">Customers</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="search-section">
        <div class="search-container">
            <input type="text" class="search-input" id="searchInput"
                   placeholder="Search by ticket title, customer name, or status...">
            <button class="search-btn" id="searchBtn"
                    style="background: #7c3aed; color: white; padding: 12px 30px;
                           border: none; border-radius: 8px; cursor: pointer; margin: 0 5px;">
                üîç Search
            </button>
            <button class="clear-btn" id="clearBtn"
                    style="background: #dc2626; color: white; padding: 12px 30px;
                           border: none; border-radius: 8px; cursor: pointer; margin: 0 5px;">
                üîÑ Clear
            </button>
        </div>
    </div>
    
    <div class="container">
        <div class="customer-section">
            <div style="background: linear-gradient(135deg, #f8f9fa 0%, #f3f4f6 100%); 
                        padding: 20px 25px; display: flex; justify-content: space-between; align-items: center;">
                <h2>Capillary</h2>
                <span style="background: #14b8a6; color: white; padding: 6px 14px; 
                           border-radius: 20px; font-size: 0.85rem; font-weight: 500;">
                    4 tickets
                </span>
            </div>
            <table>
                <tr>
                    <th width="50">#</th>
                    <th>Title</th>
                    <th width="120">ClickUp</th>
                    <th width="100">Date</th>
                    <th width="120">Status</th>
                    <th width="150">Owner</th>
                </tr>
                <tr class="expandable" data-ticket-id="Capillary_1">
                    <td><span class="expand-indicator">‚ñ∂</span> 1</td>
                    <td>New Deployer  UI elb not working.</td>
                    <td><a href="https://app.clickup.com/t/86d0hampj" 
                           style="color: #7c3aed; text-decoration: none; padding: 5px 12px; 
                                  border: 1px solid #7c3aed; border-radius: 6px; display: inline-block; font-size: 0.85rem;"
                           target="_blank" onclick="event.stopPropagation()">View</a></td>
                    <td>2025-10-06</td>
                    <td><span class="status status-open">Open</span></td>
                    <td>Unassigned</td>
                </tr>
                <tr id="details_Capillary_1" style="display: none;">
                    <td colspan="6" style="padding: 0;">
                        <div style="background: #f9fafb; padding: 20px 60px; border-left: 4px solid #7c3aed;">
                            
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 25px; 
                                        padding: 15px; background: white; border-radius: 6px;">
                                <div><strong>Customer:</strong><br>Capillary</div>
                                <div><strong>Date:</strong><br>2025-10-06</div>
                                <div><strong>Status:</strong><br>Open</div>
                                <div><strong>Owner:</strong><br>Unassigned</div>
                                <div><strong>ClickUp ID:</strong><br>86d0hampj</div>
                                <div><strong>Analysis:</strong><br>‚úÖ AI Generated</div>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #1f2937;">üìã Summary of the Issue</h4>
                                <div class="rca-content-box">
                                    <div class="rca-empty">No summary data available</div>
                                </div>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #1f2937;">üîç Steps to Debug</h4>
                                <div class="rca-content-box">
                                    <div class="rca-empty">No debug steps found</div>
                                </div>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #1f2937;">‚úÖ Steps to Resolution</h4>
                                <div class="rca-content-box">
                                    <div class="rca-empty">No resolution data available</div>
                                </div>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #1f2937;">üéØ Root Cause Analysis</h4>
                                <div class="rca-content-box">
                                    <div class="rca-empty">Root cause not identified</div>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr class="expandable" data-ticket-id="Capillary_2">
                    <td><span class="expand-indicator">‚ñ∂</span> 2</td>
                    <td>Role binding not working for custom role</td>
                    <td><a href="https://app.clickup.com/t/86d0gxvrv" 
                           style="color: #7c3aed; text-decoration: none; padding: 5px 12px; 
                                  border: 1px solid #7c3aed; border-radius: 6px; display: inline-block; font-size: 0.85rem;"
                           target="_blank" onclick="event.stopPropagation()">View</a></td>
                    <td>2025-10-04</td>
                    <td><span class="status status-default">needs customer response</span></td>
                    <td>Rauneet Verma</td>
                </tr>
                <tr id="details_Capillary_2" style="display: none;">
                    <td colspan="6" style="padding: 0;">
                        <div style="background: #f9fafb; padding: 20px 60px; border-left: 4px solid #7c3aed;">
                            
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 25px; 
                                        padding: 15px; background: white; border-radius: 6px;">
                                <div><strong>Customer:</strong><br>Capillary</div>
                                <div><strong>Date:</strong><br>2025-10-04</div>
                                <div><strong>Status:</strong><br>needs customer response</div>
                                <div><strong>Owner:</strong><br>Rauneet Verma</div>
                                <div><strong>ClickUp ID:</strong><br>86d0gxvrv</div>
                                <div><strong>Analysis:</strong><br>‚úÖ AI Generated</div>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #1f2937;">üìã Summary of the Issue</h4>
                                <div class="rca-content-box">
                                    The customer, Capillary, was attempting to implement role binding for a custom Kubernetes role using the <code class="inline-code">k8s_access_controls</code> resource. The expected outcome was that the role binding would be automatically created once the role or cluster role was established. However, the actual outcome was that the role binding was not created as anticipated. This issue was observed in their Kubernetes environment, impacting their ability to assign permissions effectively. The engineers involved were Sreejith S, Rauneet Verma, and Samarthya Gupta, who discussed the steps and configurations necessary for role binding.<br>
                                </div>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #1f2937;">üîç Steps to Debug</h4>
                                <div class="rca-content-box">
                                    1. Rauneet Verma requested Sreejith S to grant temporary access to the environment for infra testing. Sreejith confirmed that access was provided.<br><br>

2. Rauneet instructed Sreejith to change the filename to <code class="inline-code">k8s_access_controls</code> and perform a release, indicating a procedural step to ensure the correct configuration was applied.<br>

3. Sreejith S reported that he had already created the role and expected the binding to be created, indicating a discrepancy between expected and actual behavior:<br><br>
   <div class="code-block-wrapper">
<div class="code-header">üìù CODE</div>
<pre class="code-block"><code>I have already done that. I was expecting the binding to be created.</code></pre>
</div>

4. Rauneet initially noted that the <code class="inline-code">k8s_access_controls</code> does not create the role binding and clusterrolebinding, but later retracted this statement, suggesting a potential misunderstanding or miscommunication about the tool's capabilities.<br>

5. Samarthya Gupta clarified that the creation of cluster role bindings (CRB) and role bindings (RB) occurs only when the kubeconfig file is downloaded, providing insight into the operational behavior of the system.<br><br>
                                </div>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #1f2937;">‚úÖ Steps to Resolution</h4>
                                <div class="rca-content-box">
                                    1. Rauneet Verma outlined the steps to bind a user to a role once the role or cluster role is created using the <code class="inline-code">k8s_access_controls</code> resource:<br>
   <div class="code-block-wrapper">
<div class="code-header">üìù CODE</div>
<pre class="code-block"><code>once the role/cluster role is created then to bound the user to the role 

   steps :<br>
   follow these steps to bind the user to the role:<br>
   and provide the name of the role or cluster role.<br>
   Note: Only one role or cluster role can be provided.</code></pre><br>
</div>

2. It was suggested that the role binding process involves creating a custom role, mapping it to a user group, and then assigning users to that group. This procedural guidance was intended to ensure that the role binding was correctly implemented.<br><br>

3. Samarthya Gupta's clarification about the necessity of downloading the kubeconfig file for CRB and RB creation was a critical step in understanding the operational requirements for successful role binding.<br><br>
                                </div>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #1f2937;">üéØ Root Cause Analysis</h4>
                                <div class="rca-content-box">
                                    The issue appears to be related to a misunderstanding of the <code class="inline-code">k8s_access_controls</code> resource's capabilities and the operational requirements for role binding in Kubernetes. The role binding was not automatically created as expected because the process requires the kubeconfig file to be downloaded, which was not initially understood. This misunderstanding led to the expectation that role bindings would be created immediately upon role creation. Further clarification and procedural adjustments were necessary to align the team's actions with the system's operational requirements.<br>
                                </div>
                            </div>
                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #1f2937;">üìé ClickUp Attachments & Screenshots</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin: 15px 0;">
                                    <div style="border: 2px solid #e5e7eb; border-radius: 8px; overflow: hidden; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <img src="https://t3443930.p.clickup-attachments.com/t3443930/6a9337c3-9597-4f10-a63d-2918a33adcc2/image.png" alt="image.png" style="width: 100%; height: 200px; object-fit: cover; cursor: pointer;" onclick="openImageViewer('https://t3443930.p.clickup-attachments.com/t3443930/6a9337c3-9597-4f10-a63d-2918a33adcc2/image.png', 'image.png')">
                                        <div style="padding: 12px; background: #f9fafb; border-top: 1px solid #e5e7eb;">
                                            <div style="font-weight: 600; color: #374151; margin-bottom: 4px;">image.png</div>
                                            <a href="https://t3443930.p.clickup-attachments.com/t3443930/6a9337c3-9597-4f10-a63d-2918a33adcc2/image.png" target="_blank" style="color: #7c3aed; text-decoration: none; font-size: 0.85rem;">View Full Size ‚Üí</a>
                                        </div>
                                    </div>
                                    <div style="border: 2px solid #e5e7eb; border-radius: 8px; overflow: hidden; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <img src="https://t3443930.p.clickup-attachments.com/t3443930/13fc6c33-a77b-4907-9d86-0ab6e56cf221/image.png" alt="image.png" style="width: 100%; height: 200px; object-fit: cover; cursor: pointer;" onclick="openImageViewer('https://t3443930.p.clickup-attachments.com/t3443930/13fc6c33-a77b-4907-9d86-0ab6e56cf221/image.png', 'image.png')">
                                        <div style="padding: 12px; background: #f9fafb; border-top: 1px solid #e5e7eb;">
                                            <div style="font-weight: 600; color: #374151; margin-bottom: 4px;">image.png</div>
                                            <a href="https://t3443930.p.clickup-attachments.com/t3443930/13fc6c33-a77b-4907-9d86-0ab6e56cf221/image.png" target="_blank" style="color: #7c3aed; text-decoration: none; font-size: 0.85rem;">View Full Size ‚Üí</a>
                                        </div>
                                    </div>
                                    <div style="border: 2px solid #e5e7eb; border-radius: 8px; overflow: hidden; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <img src="https://t3443930.p.clickup-attachments.com/t3443930/53f2aafd-077e-4a9b-b742-4a1a0e3dea05/Screenshot%202025-10-06%20at%2012.11.38%E2%80%AFPM.png" alt="Screenshot 2025-10-06 at 12.11.38‚ÄØPM.png" style="width: 100%; height: 200px; object-fit: cover; cursor: pointer;" onclick="openImageViewer('https://t3443930.p.clickup-attachments.com/t3443930/53f2aafd-077e-4a9b-b742-4a1a0e3dea05/Screenshot%202025-10-06%20at%2012.11.38%E2%80%AFPM.png', 'Screenshot 2025-10-06 at 12.11.38‚ÄØPM.png')">
                                        <div style="padding: 12px; background: #f9fafb; border-top: 1px solid #e5e7eb;">
                                            <div style="font-weight: 600; color: #374151; margin-bottom: 4px;">Screenshot 2025-10-06 at 12.11.38‚ÄØPM.png</div>
                                            <a href="https://t3443930.p.clickup-attachments.com/t3443930/53f2aafd-077e-4a9b-b742-4a1a0e3dea05/Screenshot%202025-10-06%20at%2012.11.38%E2%80%AFPM.png" target="_blank" style="color: #7c3aed; text-decoration: none; font-size: 0.85rem;">View Full Size ‚Üí</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr class="expandable" data-ticket-id="Capillary_3">
                    <td><span class="expand-indicator">‚ñ∂</span> 3</td>
                    <td>crm-nightly-new env release failing (Unidentified error occurred)</td>
                    <td><a href="https://app.clickup.com/t/86d0fnqnb" 
                           style="color: #7c3aed; text-decoration: none; padding: 5px 12px; 
                                  border: 1px solid #7c3aed; border-radius: 6px; display: inline-block; font-size: 0.85rem;"
                           target="_blank" onclick="event.stopPropagation()">View</a></td>
                    <td>2025-09-30</td>
                    <td><span class="status status-progress">in progress</span></td>
                    <td>Omendra Tomar</td>
                </tr>
                <tr id="details_Capillary_3" style="display: none;">
                    <td colspan="6" style="padding: 0;">
                        <div style="background: #f9fafb; padding: 20px 60px; border-left: 4px solid #7c3aed;">
                            
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 25px; 
                                        padding: 15px; background: white; border-radius: 6px;">
                                <div><strong>Customer:</strong><br>Capillary</div>
                                <div><strong>Date:</strong><br>2025-09-30</div>
                                <div><strong>Status:</strong><br>in progress</div>
                                <div><strong>Owner:</strong><br>Omendra Tomar</div>
                                <div><strong>ClickUp ID:</strong><br>86d0fnqnb</div>
                                <div><strong>Analysis:</strong><br>‚úÖ AI Generated</div>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #1f2937;">üìã Summary of the Issue</h4>
                                <div class="rca-content-box">
                                    The customer, Capillary, was attempting to execute a release in their <code class="inline-code">crm-nightly-new</code> environment, which was expected to complete within 10-12 minutes as per usual. However, the release was failing with an unidentified error, and subsequent attempts were hindered by a state lock issue. Additionally, the release process was taking significantly longer, up to 30+ minutes, across non-production clusters. The environment involved was the IAC stage/3.30.20, which was recently updated with new feature actions that appeared to be causing the instability.<br>
                                </div>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #1f2937;">üîç Steps to Debug</h4>
                                <div class="rca-content-box">
                                    1. **Nihar Jain** observed that releases were taking longer than expected, noting that the IAC stage/3.30.20 releases were completing in 30+ minutes compared to the usual 10-12 minutes.<br><br>
   <div class="code-block-wrapper">
<div class="code-header">üìù CODE</div>
<pre class="code-block"><code>i have observed one more thing, that from</code></pre>
</div>

2. **Omendra Tomar** identified that the issue was likely due to newly introduced feature actions in the recent releases. This was determined after reviewing the changes made in the IAC stage/3.30.20.<br><br>

3. **Nihar Jain** reverted the IAC to stage/3.30.19 to test if the issue was related to the recent changes. This action was taken to see if reverting would restore the release times to normal.<br><br>
   <div class="code-block-wrapper">
<div class="code-header">üìù CODE</div>
<pre class="code-block"><code>I reverted IAC to stage/3.30.19, and release is taking as usual time, currently i am pinning all my non-prod cluster to IAC - stage/3.30.19.</code></pre>
</div>

4. After the reversion, **Nihar Jain** confirmed that the releases were no longer failing, but noted that the time to complete releases in all non-prod clusters remained high.<br><br>
   <div class="code-block-wrapper">
<div class="code-header">üìù CODE</div>
<pre class="code-block"><code>now releases are not failing, but time to complete release in all non prod cluster is very high</code></pre>
</div>
                                </div>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #1f2937;">‚úÖ Steps to Resolution</h4>
                                <div class="rca-content-box">
                                    1. **Omendra Tomar** decided to revert the newly introduced feature actions in the IAC stage/3.30.20 to restore stability. This rollback was intended to address the release failures and reduce the completion time.<br><br>

2. **Nihar Jain** reverted the IAC to stage/3.30.19, which successfully restored the release times to their usual duration. This step was confirmed as effective in resolving the immediate issue of prolonged release times.<br><br>
   <div class="code-block-wrapper">
<div class="code-header">üìù CODE</div>
<pre class="code-block"><code>I reverted IAC to stage/3.30.19, and release is taking as usual time, currently i am pinning all my non-prod cluster to IAC - stage/3.30.19.</code></pre>
</div>

3. **Prashant Dhanke** communicated to the team to avoid pushing the problematic changes to the production tag until the issue was resolved in the stage tag. This was to prevent similar issues in the production environment.<br><br>
                                </div>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #1f2937;">üéØ Root Cause Analysis</h4>
                                <div class="rca-content-box">
                                    The likely root cause of the issue was the newly introduced feature actions in the IAC stage/3.30.20, which caused the release process to take significantly longer and led to failures due to state lock issues. This was identified by comparing the performance of releases before and after the introduction of these features. Reverting to the previous stable version, IAC stage/3.30.19, resolved the issue, confirming that the new features were the source of the problem. Further investigation into the specific changes in the feature actions is needed to prevent recurrence.<br><br>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr class="expandable" data-ticket-id="Capillary_4">
                    <td><span class="expand-indicator">‚ñ∂</span> 4</td>
                    <td>ecr-token-refresher-deployer job is failing leading to issues in multiple pod image pull in SGCRM</td>
                    <td><a href="https://app.clickup.com/t/86d0f8aq1" 
                           style="color: #7c3aed; text-decoration: none; padding: 5px 12px; 
                                  border: 1px solid #7c3aed; border-radius: 6px; display: inline-block; font-size: 0.85rem;"
                           target="_blank" onclick="event.stopPropagation()">View</a></td>
                    <td>2025-09-29</td>
                    <td><span class="status status-default">customer side fix</span></td>
                    <td>Rauneet Verma</td>
                </tr>
                <tr id="details_Capillary_4" style="display: none;">
                    <td colspan="6" style="padding: 0;">
                        <div style="background: #f9fafb; padding: 20px 60px; border-left: 4px solid #7c3aed;">
                            
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 25px; 
                                        padding: 15px; background: white; border-radius: 6px;">
                                <div><strong>Customer:</strong><br>Capillary</div>
                                <div><strong>Date:</strong><br>2025-09-29</div>
                                <div><strong>Status:</strong><br>customer side fix</div>
                                <div><strong>Owner:</strong><br>Rauneet Verma</div>
                                <div><strong>ClickUp ID:</strong><br>86d0f8aq1</div>
                                <div><strong>Analysis:</strong><br>‚úÖ AI Generated</div>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #1f2937;">üìã Summary of the Issue</h4>
                                <div class="rca-content-box">
                                    The customer, Capillary, was experiencing issues with the <code class="inline-code">ecr-token-refresher-deployer</code> job, which was failing and causing problems with multiple pod image pulls in the SGCRM environment. The expected behavior was for the pods to pull images successfully and operate normally. However, the <code class="inline-code">coredns</code> pods were in a pending state, preventing the <code class="inline-code">ecr-token-refresher-deployer</code> pods from creating the necessary secrets. This issue impacted the deployment and operation of services reliant on these pods, leading to an urgent priority status for resolution.<br>
                                </div>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #1f2937;">üîç Steps to Debug</h4>
                                <div class="rca-content-box">
                                    1. Rauneet Verma observed that the <code class="inline-code">coredns</code> pods were in a pending state, which was preventing the <code class="inline-code">ecr-token-refresher-deployer</code> pods from functioning correctly. This was identified as a potential cause of the issue because the <code class="inline-code">coredns</code> pods are essential for DNS resolution in Kubernetes clusters.<br>

2. To address the pending state of the <code class="inline-code">coredns</code> pods, Rauneet Verma deleted the <code class="inline-code">coredns</code> pods. This action was taken to force the Kubernetes scheduler to reschedule the pods, which could resolve any underlying scheduling conflicts or resource allocation issues.<br>

3. After deleting the <code class="inline-code">coredns</code> pods, Rauneet Verma confirmed that they were successfully rescheduled and that the <code class="inline-code">ecr-token-refresher-deployer</code> pods were able to create the necessary secrets. This was verified by observing that the pods were up and running, indicating that the immediate issue had been resolved.<br>
                                </div>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #1f2937;">‚úÖ Steps to Resolution</h4>
                                <div class="rca-content-box">
                                    1. Rauneet Verma deleted the <code class="inline-code">coredns</code> pods to resolve their pending state. This action was intended to allow the Kubernetes scheduler to reschedule the pods, thereby resolving any issues related to resource allocation or scheduling conflicts.<br>

2. After the deletion and successful rescheduling of the <code class="inline-code">coredns</code> pods, the <code class="inline-code">ecr-token-refresher-deployer</code> pods were able to create the required secrets. This step was crucial as it enabled the pods to pull images successfully, restoring normal operation.<br>

3. The customer was advised to monitor the pods to ensure that they remain in a healthy state and to verify that the <code class="inline-code">ecr-token-refresher-deployer</code> job continues to function as expected. This ongoing monitoring is necessary to prevent recurrence of the issue.<br>
                                </div>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #1f2937;">üéØ Root Cause Analysis</h4>
                                <div class="rca-content-box">
                                    The likely root cause of the issue was the <code class="inline-code">coredns</code> pods being in a pending state, which prevented the <code class="inline-code">ecr-token-refresher-deployer</code> pods from creating the necessary secrets. This pending state was likely due to scheduling conflicts or resource allocation issues within the Kubernetes cluster. By deleting and rescheduling the <code class="inline-code">coredns</code> pods, the issue was resolved, allowing the <code class="inline-code">ecr-token-refresher-deployer</code> pods to function correctly. Further investigation into the cluster's resource management and scheduling policies may be needed to prevent similar issues in the future.<br>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr></table></div>
    </div>
    
    <script>
        // Ensure all details are expanded when printing
        window.addEventListener('beforeprint', function() {
            // Expand all detail rows before printing
            const detailRows = document.querySelectorAll('[id^="details_"]');
            detailRows.forEach(row => {
                row.style.display = 'table-row';
            });
            
            // Hide expand indicators
            const indicators = document.querySelectorAll('.expand-indicator');
            indicators.forEach(indicator => {
                indicator.style.display = 'none';
            });
        });
        
        // Optional: Restore collapsed state after printing (commented out to keep expanded)
        // window.addEventListener('afterprint', function() {
        //     const detailRows = document.querySelectorAll('[id^="details_"]');
        //     detailRows.forEach(row => {
        //         row.style.display = 'none';
        //     });
        // });
        
        function toggleDetails(ticketId) {
            const detailsRow = document.getElementById('details_' + ticketId);
            const clickedRow = detailsRow.previousElementSibling;
            const indicator = clickedRow.querySelector('.expand-indicator');
            
            if (detailsRow.style.display === 'table-row') {
                detailsRow.style.display = 'none';
                indicator.innerHTML = '‚ñ∂';
                clickedRow.classList.remove('expanded');
            } else {
                // Close all other expanded rows
                document.querySelectorAll('[id^="details_"]').forEach(row => {
                    row.style.display = 'none';
                    if (row.previousElementSibling) {
                        row.previousElementSibling.classList.remove('expanded');
                        row.previousElementSibling.querySelector('.expand-indicator').innerHTML = '‚ñ∂';
                    }
                });
                
                detailsRow.style.display = 'table-row';
                indicator.innerHTML = '‚ñº';
                clickedRow.classList.add('expanded');
            }
        }
        
        let lastEnterTime = 0;

        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            const sections = document.querySelectorAll('.customer-section');
            let totalVisible = 0;

            sections.forEach(section => {
                const customerName = section.querySelector('h2').textContent.toLowerCase();
                const rows = section.querySelectorAll('tr.expandable');
                let hasVisibleRows = false;

                rows.forEach(row => {
                    const cells = row.cells;
                    const title = cells[1] ? cells[1].textContent.toLowerCase() : '';
                    const clickupId = cells[2] ? cells[2].textContent.toLowerCase() : '';
                    const date = cells[3] ? cells[3].textContent.toLowerCase() : '';
                    const status = cells[4] ? cells[4].textContent.toLowerCase() : '';
                    const owner = cells[5] ? cells[5].textContent.toLowerCase() : '';

                    const shouldShow = searchTerm === '' ||
                                     title.includes(searchTerm) ||
                                     customerName.includes(searchTerm) ||
                                     clickupId.includes(searchTerm) ||
                                     date.includes(searchTerm) ||
                                     status.includes(searchTerm) ||
                                     owner.includes(searchTerm);

                    row.style.display = shouldShow ? '' : 'none';
                    if (shouldShow) {
                        hasVisibleRows = true;
                        totalVisible++;
                    }

                    // Hide details row if main row is hidden
                    const detailsRow = row.nextElementSibling;
                    if (detailsRow && detailsRow.id && detailsRow.id.startsWith('details_')) {
                        detailsRow.style.display = shouldShow ? '' : 'none';
                    }
                });

                section.style.display = hasVisibleRows ? '' : 'none';
            });

            updateSearchStatus(searchTerm ? `Found ${totalVisible} result(s)` : '');
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            performSearch();
            updateSearchStatus('Search cleared');
        }

        function updateSearchStatus(message) {
            let statusDiv = document.getElementById('searchStatus');
            if (!statusDiv) {
                statusDiv = document.createElement('div');
                statusDiv.id = 'searchStatus';
                statusDiv.style.cssText = 'text-align: center; padding: 10px; color: #7c3aed; font-size: 14px;';
                document.querySelector('.search-section').appendChild(statusDiv);
            }
            statusDiv.textContent = message;
            if (message) {
                setTimeout(() => { statusDiv.textContent = ''; }, 2000);
            }
        }
        
        // Enhanced keyboard support
        document.getElementById('searchInput').addEventListener('keyup', function(event) {
            const currentTime = Date.now();

            if (event.key === 'Enter') {
                if (this.value === '' && currentTime - lastEnterTime < 500) {
                    // Double-Enter on empty field clears any filters
                    clearSearch();
                    lastEnterTime = 0;
                } else {
                    performSearch();
                    lastEnterTime = currentTime;
                }
            } else if (event.key === 'Escape') {
                clearSearch();
            }
        });

        // Real-time search as you type
        document.getElementById('searchInput').addEventListener('input', function() {
            performSearch();
        });

        // Clear on double-click
        document.getElementById('searchInput').addEventListener('dblclick', function() {
            clearSearch();
        });

        // Cloud URLs will be injected here after upload
        window.reportCloudUrls = {};

        // Share functionality
        function shareReport() {
            console.log('Share button clicked!'); // Debug log

            const modal = document.getElementById('shareModal');
            const urlInput = document.getElementById('shareUrl');

            if (!modal) {
                console.error('Share modal not found!');
                alert('Error: Share modal not found. Please refresh the page.');
                return;
            }

            if (!urlInput) {
                console.error('Share URL input not found!');
                alert('Error: Share URL input not found. Please refresh the page.');
                return;
            }

            // Get the current page URL (or use the cloud URL if available)
            let shareUrl = window.location.href;

            // Check if we have cloud URLs stored in the page
            const cloudUrls = window.reportCloudUrls || {};
            console.log('Available cloud URLs:', cloudUrls); // Debug log

            // Prefer GitHub Pages, then Gist, then regular preview, then transfer.sh, then local
            if (cloudUrls.github_repo && cloudUrls.github_repo.github_pages_url) {
                shareUrl = cloudUrls.github_repo.github_pages_url;
                console.log('Using GitHub Pages URL (best option)');
            } else if (cloudUrls.github_gist && cloudUrls.github_gist.preview_url) {
                shareUrl = cloudUrls.github_gist.preview_url;
                console.log('Using GitHub gist preview URL');
            } else if (cloudUrls.github_repo && cloudUrls.github_repo.preview_url) {
                shareUrl = cloudUrls.github_repo.preview_url;
                console.log('Using GitHub repo preview URL (limited JavaScript)');
            } else if (cloudUrls.transfer_sh) {
                shareUrl = cloudUrls.transfer_sh;
                console.log('Using transfer.sh URL');
            } else {
                console.log('Using local file URL');
            }

            urlInput.value = shareUrl;

            // Also populate the backup URL (HTML Preview)
            const backupUrlInput = document.getElementById('shareUrlBackup');
            if (backupUrlInput) {
                let backupUrl = '';
                if (cloudUrls.github_repo && cloudUrls.github_repo.preview_url) {
                    backupUrl = cloudUrls.github_repo.preview_url;
                } else if (cloudUrls.github_gist && cloudUrls.github_gist.preview_url) {
                    backupUrl = cloudUrls.github_gist.preview_url;
                } else {
                    // Fallback: construct htmlpreview URL from current location
                    const currentUrl = window.location.href;
                    if (currentUrl.includes('github.io')) {
                        // Convert GitHub Pages URL to htmlpreview URL
                        const rawUrl = currentUrl.replace('abhishub-12.github.io/RCA-REPORTS/', 'raw.githubusercontent.com/AbhisHub-12/RCA-REPORTS/main/');
                        backupUrl = 'https://htmlpreview.github.io/?' + rawUrl;
                    } else {
                        backupUrl = 'HTML Preview not available for local files';
                    }
                }
                backupUrlInput.value = backupUrl;

                // Hide backup section if not available
                const backupSection = document.getElementById('backupSection');
                if (backupSection) {
                    if (backupUrl === 'HTML Preview not available for local files') {
                        backupSection.style.display = 'none';
                    } else {
                        backupSection.style.display = 'block';
                    }
                }
            }

            modal.style.display = 'block';
            console.log('Modal should now be visible'); // Debug log
        }

        function closeShareModal() {
            document.getElementById('shareModal').style.display = 'none';
            document.getElementById('copySuccess').style.display = 'none';
        }

        function copyShareLink() {
            const urlInput = document.getElementById('shareUrl');
            const copySuccess = document.getElementById('copySuccess');

            // Select and copy the text
            urlInput.select();
            urlInput.setSelectionRange(0, 99999); // For mobile devices

            try {
                document.execCommand('copy');
                copySuccess.style.display = 'block';

                // Hide success message after 3 seconds
                setTimeout(() => {
                    copySuccess.style.display = 'none';
                }, 3000);
            } catch (err) {
                // Fallback for modern browsers
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(urlInput.value).then(() => {
                        copySuccess.style.display = 'block';
                        setTimeout(() => {
                            copySuccess.style.display = 'none';
                        }, 3000);
                    });
                }
            }
        }

        function shareViaEmail() {
            const url = document.getElementById('shareUrl').value;
            const subject = encodeURIComponent('RCA Report - ' + document.title);
            const body = encodeURIComponent('Here is the RCA report:\n\n' + url);
            window.location.href = 'mailto:?subject=' + subject + '&body=' + body;
        }

        function shareViaSlack() {
            const url = document.getElementById('shareUrl').value;
            const text = encodeURIComponent('RCA Report: ' + url);
            // Open Slack's share URL (user needs to be logged in)
            window.open('https://slack.com/intl/en-in/share?url=' + encodeURIComponent(url), '_blank');
        }

        function shareViaTeams() {
            const url = document.getElementById('shareUrl').value;
            const text = encodeURIComponent('Check out this RCA Report');
            // Open Teams share dialog
            window.open('https://teams.microsoft.com/share?href=' + encodeURIComponent(url) + '&text=' + text, '_blank');
        }

        function shareViaWhatsApp() {
            const url = document.getElementById('shareUrl').value;
            const text = encodeURIComponent('RCA Report: ' + url);
            // Open WhatsApp with pre-filled message
            window.open('https://wa.me/?text=' + text, '_blank');
        }

        function copyBackupLink() {
            const backupUrlInput = document.getElementById('shareUrlBackup');
            // Select and copy the text
            backupUrlInput.select();
            backupUrlInput.setSelectionRange(0, 99999); // For mobile devices
            try {
                document.execCommand('copy');
                // Show temporary success indicator
                const button = document.getElementById('copyBackupLinkBtn');
                const originalText = button.innerHTML;
                button.innerHTML = '‚úÖ Copied!';
                button.style.background = '#10b981';
                // Reset after 2 seconds
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.style.background = '#059669';
                }, 2000);
            } catch (err) {
                console.error('Failed to copy backup link: ', err);
                alert('Failed to copy to clipboard. Please copy manually.');
            }
        }

        // Image Viewer Functions
        function openImageViewer(imageUrl, imageTitle) {
            const modal = document.getElementById('imageViewerModal');
            const image = document.getElementById('imageViewerImage');
            const title = document.getElementById('imageViewerTitle');

            image.src = imageUrl;
            image.alt = imageTitle;
            title.textContent = imageTitle;
            modal.style.display = 'block';

            // Prevent body scroll when modal is open
            document.body.style.overflow = 'hidden';
        }

        function closeImageViewer() {
            const modal = document.getElementById('imageViewerModal');
            modal.style.display = 'none';

            // Restore body scroll
            document.body.style.overflow = 'auto';
        }

        // Close image viewer with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeImageViewer();
            }
        });

        // Close modal when clicking outside
        document.getElementById('shareModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeShareModal();
            }
        });

        // Add keyboard shortcut for share (Ctrl+Shift+S)
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'S') {
                e.preventDefault();
                shareReport();
            }
        });

        // Enhanced debugging for GitHub Pages
        console.log('üîß SCRIPT LOADING: JavaScript file started');
        console.log('üåê ENVIRONMENT:', window.location.href);
        console.log('üìç USER AGENT:', navigator.userAgent);

        // Check for Content Security Policy issues
        if (typeof window.CSP !== 'undefined') {
            console.log('‚ö†Ô∏è CSP DETECTED:', window.CSP);
        }

        // Validate all functions are loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚úÖ DOM Content Loaded');
            console.log('‚úÖ ShareReport function:', typeof shareReport);
            console.log('‚úÖ ToggleDetails function:', typeof toggleDetails);
            console.log('‚úÖ Share modal element:', document.getElementById('shareModal') ? 'Found' : 'Not Found');
            console.log('‚úÖ Cloud URLs:', window.reportCloudUrls);

            // Test basic DOM manipulation
            try {
                const testElement = document.querySelector('.expandable');
                if (testElement) {
                    console.log('‚úÖ EXPANDABLE ELEMENTS FOUND:', document.querySelectorAll('.expandable').length);
                } else {
                    console.log('‚ùå NO EXPANDABLE ELEMENTS FOUND');
                }
            } catch (error) {
                console.error('‚ùå DOM QUERY ERROR:', error);
            }

            // Test event listener attachment
            try {
                const shareBtn = document.getElementById('shareReportBtn');
                if (shareBtn) {
                    console.log('‚úÖ SHARE BUTTON FOUND, ATTACHING LISTENERS');
                } else {
                    console.log('‚ùå SHARE BUTTON NOT FOUND');
                }
            } catch (error) {
                console.error('‚ùå EVENT LISTENER ERROR:', error);
            }

            // Add event listeners for ticket expansion (GitHub Pages compatible)
            document.querySelectorAll('.expandable').forEach(row => {
                row.addEventListener('click', function() {
                    const ticketId = this.getAttribute('data-ticket-id');
                    if (ticketId) {
                        toggleDetails(ticketId);
                    }
                });
            });

            // Add event listener for share button (GitHub Pages compatible)
            const shareBtn = document.getElementById('shareReportBtn');
            if (shareBtn) {
                shareBtn.addEventListener('click', function() {
                    console.log('Share button clicked via event listener!');
                    shareReport();
                });
            }

            // Add event listener for print button (GitHub Pages compatible)
            const printBtn = document.getElementById('printBtn');
            if (printBtn) {
                printBtn.addEventListener('click', function() {
                    window.print();
                });
            }

            // Add event listeners for modal buttons (GitHub Pages compatible)
            const closeModalBtn = document.getElementById('closeModalBtn');
            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', closeShareModal);
            }

            const copyLinkBtn = document.getElementById('copyLinkBtn');
            if (copyLinkBtn) {
                copyLinkBtn.addEventListener('click', copyShareLink);
            }

            const copyBackupLinkBtn = document.getElementById('copyBackupLinkBtn');
            if (copyBackupLinkBtn) {
                copyBackupLinkBtn.addEventListener('click', copyBackupLink);
            }

            const shareEmailBtn = document.getElementById('shareEmailBtn');
            if (shareEmailBtn) {
                shareEmailBtn.addEventListener('click', shareViaEmail);
            }

            const shareSlackBtn = document.getElementById('shareSlackBtn');
            if (shareSlackBtn) {
                shareSlackBtn.addEventListener('click', shareViaSlack);
            }

            const shareTeamsBtn = document.getElementById('shareTeamsBtn');
            if (shareTeamsBtn) {
                shareTeamsBtn.addEventListener('click', shareViaTeams);
            }

            const shareWhatsAppBtn = document.getElementById('shareWhatsAppBtn');
            if (shareWhatsAppBtn) {
                shareWhatsAppBtn.addEventListener('click', shareViaWhatsApp);
            }

            // Add event listeners for search buttons (GitHub Pages compatible)
            const searchBtn = document.getElementById('searchBtn');
            if (searchBtn) {
                searchBtn.addEventListener('click', performSearch);
            }

            const clearBtn = document.getElementById('clearBtn');
            if (clearBtn) {
                clearBtn.addEventListener('click', clearSearch);
            }
        });
    </script>
</body>
</html>